<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student OS - God Mode</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg-dark: #0b0e14;
            --bg-panel: #151a23;
            --primary: #00f2ea;
            --secondary: #ff0055;
            --accent: #7000ff;
            --text: #ffffff;
            --text-muted: #8b9bb4;
            --border: #2a3441;
            --glass: rgba(21, 26, 35, 0.8);
        }

        * { box-sizing: border-box; scrollbar-width: thin; scrollbar-color: var(--primary) var(--bg-dark); }
        body { margin: 0; font-family: 'Space Grotesk', sans-serif; background: var(--bg-dark); color: var(--text); height: 100vh; overflow: hidden; display: flex; }

        /* --- LAYOUT --- */
        aside { width: 80px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; z-index: 100; transition: width 0.3s; }
        aside:hover { width: 220px; }
        aside:hover .nav-text { display: inline-block; opacity: 1; }

        .brand { color: var(--primary); font-size: 2rem; margin-bottom: 40px; }
        
        nav button {
            background: none; border: none; color: var(--text-muted); width: 100%; padding: 15px 20px;
            display: flex; align-items: center; cursor: pointer; transition: 0.2s; font-size: 1.1rem;
        }
        nav button:hover, nav button.active { color: var(--text); background: rgba(255,255,255,0.05); border-left: 3px solid var(--primary); }
        nav i { width: 30px; text-align: center; margin-right: 10px; font-size: 1.2rem; }
        .nav-text { display: none; opacity: 0; white-space: nowrap; transition: 0.2s; }

        main { flex: 1; position: relative; overflow-y: auto; padding: 30px; background-image: radial-gradient(circle at top right, rgba(112,0,255,0.15), transparent 40%); }

        /* --- COMPONENTS --- */
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Level Bar */
        .user-profile { display: flex; align-items: center; gap: 15px; background: var(--bg-panel); padding: 10px 20px; border-radius: 50px; border: 1px solid var(--border); }
        .avatar { width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .xp-container { width: 150px; }
        .level-info { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 3px; }
        .xp-bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.5s; }

        .section { display: none; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .grid-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 16px; padding: 25px; position: relative; overflow: hidden; }
        .card h3 { margin-top: 0; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .big-stat { font-size: 3rem; font-weight: 700; background: linear-gradient(to right, #fff, #aaa); -webkit-background-clip: text; color: transparent; }

        /* Input & Buttons */
        input, select { background: #0b0e14; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; width: 100%; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--primary); }
        .btn { background: var(--primary); color: #000; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: transform 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 242, 234, 0.3); }
        .btn-danger { background: var(--secondary); color: white; }

        /* Module Specifics */
        .todo-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid var(--border); }
        .todo-item.done span { text-decoration: line-through; color: var(--text-muted); }
        .check-circle { width: 20px; height: 20px; border: 2px solid var(--primary); border-radius: 50%; cursor: pointer; }
        .check-circle.checked { background: var(--primary); }

        .pomodoro-box { text-align: center; padding: 40px; }
        .timer-display { font-size: 5rem; font-weight: 700; font-variant-numeric: tabular-nums; }
        
        .timetable-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day-col { background: rgba(255,255,255,0.02); padding: 10px; border-radius: 8px; min-height: 200px; }
        .day-header { text-align: center; font-weight: bold; margin-bottom: 10px; color: var(--primary); }

        /* Badge System */
        .badge-grid { display: flex; gap: 10px; flex-wrap: wrap; }
        .achievement { width: 50px; height: 50px; background: #222; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; opacity: 0.3; filter: grayscale(1); transition: 0.3s; position: relative; }
        .achievement.unlocked { opacity: 1; filter: grayscale(0); background: rgba(0, 242, 234, 0.1); border: 1px solid var(--primary); }
        .achievement:hover::after { content: attr(title); position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); background: #000; padding: 5px 10px; font-size: 12px; border-radius: 4px; white-space: nowrap; z-index: 10; }

    </style>
</head>
<body>

    <aside>
        <div class="brand"><i class="fas fa-meteor"></i></div>
        <nav>
            <button onclick="switchTab('dashboard')" class="active"><i class="fas fa-chart-pie"></i> <span class="nav-text">T·ªïng Quan</span></button>
            <button onclick="switchTab('grades')"><i class="fas fa-calculator"></i> <span class="nav-text">ƒêi·ªÉm S·ªë</span></button>
            <button onclick="switchTab('tasks')"><i class="fas fa-check-double"></i> <span class="nav-text">Nhi·ªám V·ª•</span></button>
            <button onclick="switchTab('schedule')"><i class="fas fa-calendar-alt"></i> <span class="nav-text">L·ªãch H·ªçc</span></button>
            <button onclick="switchTab('focus')"><i class="fas fa-stopwatch"></i> <span class="nav-text">Focus Mode</span></button>
            <button onclick="switchTab('finance')"><i class="fas fa-wallet"></i> <span class="nav-text">H·ªçc Ph√≠</span></button>
        </nav>
    </aside>

    <main>
        <div class="header-bar">
            <div>
                <h1 style="margin:0;">Xin ch√†o, <span id="userName">User</span> üëã</h1>
                <p style="margin:5px 0 0; color:var(--text-muted);">H√¥m nay b·∫°n mu·ªën chinh ph·ª•c ƒëi·ªÅu g√¨?</p>
            </div>
            <div class="user-profile">
                <div class="avatar"><i class="fas fa-user-astronaut"></i></div>
                <div class="xp-container">
                    <div class="level-info">
                        <span style="color:var(--primary); font-weight:bold;">LV. <span id="userLevel">1</span></span>
                        <span id="xpText">0/100 XP</span>
                    </div>
                    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
                </div>
            </div>
        </div>

        <div id="dashboard" class="section active">
            <div class="grid-dashboard">
                <div class="card">
                    <h3>GPA T√≠ch L≈©y</h3>
                    <div class="big-stat" id="dashGPA">0.0</div>
                    <div style="font-size:0.9rem; color:var(--text-muted);">Rank: <span id="rankTitle">T√¢n Binh</span></div>
                </div>
                <div class="card">
                    <h3>Nhi·ªám V·ª• ƒê√£ Xong</h3>
                    <div class="big-stat" id="dashTasks">0</div>
                </div>
                <div class="card" style="grid-column: span 2;">
                    <h3>Th√†nh T·ª±u (Achievements)</h3>
                    <div class="badge-grid" id="badgeList">
                        </div>
                </div>
                <div class="card" style="grid-column: span 2; height: 300px;">
                    <canvas id="gradeChart"></canvas>
                </div>
            </div>
        </div>

        <div id="grades" class="section">
            <div class="grid-dashboard">
                <div class="card">
                    <h3>Nh·∫≠p ƒêi·ªÉm M·ªõi</h3>
                    <input type="text" id="subName" placeholder="T√™n m√¥n h·ªçc">
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="subCred" placeholder="S·ªë t√≠n ch·ªâ" value="3">
                        <select id="subRatio">
                            <option value="0.3">30% QT</option>
                            <option value="0.4">40% QT</option>
                            <option value="0.5" selected>50% QT</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="subQT" placeholder="ƒêi·ªÉm QT">
                        <input type="number" id="subCK" placeholder="ƒêi·ªÉm CK">
                    </div>
                    <button class="btn" onclick="addSubject()">L∆∞u & Nh·∫≠n XP</button>
                </div>
                <div class="card" style="grid-column: span 2;">
                    <h3>Danh S√°ch M√¥n H·ªçc</h3>
                    <div id="subjectList" style="max-height: 400px; overflow-y:auto;">
                        </div>
                </div>
            </div>
        </div>

        <div id="tasks" class="section">
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <h3><i class="fas fa-bolt"></i> Nhi·ªám V·ª• C·∫ßn L√†m</h3>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="taskInput" placeholder="V√≠ d·ª•: L√†m b√†i t·∫≠p Gi·∫£i t√≠ch..." onkeypress="if(event.key==='Enter') addTask()">
                    <button class="btn" style="width:auto; margin:0;" onclick="addTask()"><i class="fas fa-plus"></i></button>
                </div>
                <div id="taskList"></div>
            </div>
        </div>

        <div id="schedule" class="section">
            <div class="card">
                <h3>Th·ªùi Kh√≥a Bi·ªÉu (Beta)</h3>
                <div class="timetable-grid">
                    <div class="day-col"><div class="day-header">Th·ª© 2</div><div id="d2"></div></div>
                    <div class="day-col"><div class="day-header">Th·ª© 3</div><div id="d3"></div></div>
                    <div class="day-col"><div class="day-header">Th·ª© 4</div><div id="d4"></div></div>
                    <div class="day-col"><div class="day-header">Th·ª© 5</div><div id="d5"></div></div>
                    <div class="day-col"><div class="day-header">Th·ª© 6</div><div id="d6"></div></div>
                    <div class="day-col"><div class="day-header">Th·ª© 7</div><div id="d7"></div></div>
                    <div class="day-col"><div class="day-header">CN</div><div id="d8"></div></div>
                </div>
                <p style="text-align:center; color:gray; font-size:0.8rem; margin-top:10px;">*T√≠nh nƒÉng k√©o th·∫£ ƒëang ph√°t tri·ªÉn. Hi·ªán t·∫°i ch·ªâ hi·ªÉn th·ªã m·∫´u.</p>
            </div>
        </div>

        <div id="focus" class="section">
            <div class="card pomodoro-box">
                <h3 style="margin-bottom: 30px;">DEEP WORK SESSION</h3>
                <div class="timer-display" id="timer">25:00</div>
                <div style="display:flex; justify-content:center; gap:20px; margin-top:30px;">
                    <button class="btn" onclick="startTimer()" style="width:150px; background:var(--accent); color:white;">B·∫Øt ƒë·∫ßu</button>
                    <button class="btn btn-outline" onclick="resetTimer()" style="width:100px; background: #333; color:white;">Reset</button>
                </div>
                <p style="margin-top:20px; color:gray;">Ho√†n th√†nh 1 phi√™n = +50 XP</p>
            </div>
        </div>

        <div id="finance" class="section">
            <div class="card" style="max-width: 500px; margin: 0 auto;">
                <h3><i class="fas fa-coins"></i> M√°y T√≠nh H·ªçc Ph√≠</h3>
                <label>Gi√° 1 t√≠n ch·ªâ (VNƒê)</label>
                <input type="number" id="pricePerCredit" value="850000">
                
                <div style="background: rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-top:20px;">
                    <div style="display:flex; justify-content:space-between;">
                        <span>T·ªïng s·ªë t√≠n ch·ªâ ƒë√£ h·ªçc:</span>
                        <strong id="finCredits">0</strong>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:1.2rem; color:var(--primary);">
                        <span>T·ªïng h·ªçc ph√≠ ∆∞·ªõc t√≠nh:</span>
                        <strong id="finTotal">0 ƒë</strong>
                    </div>
                </div>
                <button class="btn" onclick="calcFinance()" style="margin-top:20px;">C·∫≠p Nh·∫≠t Gi√°</button>
            </div>
        </div>

    </main>

    <script>
        // --- DATA STORE ---
        const appData = JSON.parse(localStorage.getItem('studentOS')) || {
            user: { name: 'Sinh Vi√™n', level: 1, xp: 0, maxXp: 100 },
            subjects: [],
            tasks: [],
            badges: { 'first_A': false, 'level_5': false, 'task_master': false }
        };

        let chartInstance = null;
        let timerInterval = null;
        let timeLeft = 25 * 60;

        // --- INIT ---
        updateUI();
        renderBadges();

        // --- NAVIGATION ---
        function switchTab(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if(id === 'dashboard') updateUI();
        }

        // --- GAMIFICATION SYSTEM ---
        function addXP(amount) {
            appData.user.xp += amount;
            if (appData.user.xp >= appData.user.maxXp) {
                appData.user.level++;
                appData.user.xp = appData.user.xp - appData.user.maxXp;
                appData.user.maxXp = Math.floor(appData.user.maxXp * 1.2);
                alert(`üéâ LEVEL UP! B·∫°n ƒë√£ ƒë·∫°t Level ${appData.user.level}`);
                checkBadges();
            }
            saveData();
            updateHeader();
        }

        function updateHeader() {
            document.getElementById('userLevel').textContent = appData.user.level;
            document.getElementById('xpText').textContent = `${Math.floor(appData.user.xp)}/${appData.user.maxXp} XP`;
            const pct = (appData.user.xp / appData.user.maxXp) * 100;
            document.getElementById('xpFill').style.width = `${pct}%`;
        }

        function checkBadges() {
            // Logic check badges
            if (appData.user.level >= 5 && !appData.badges.level_5) {
                appData.badges.level_5 = true;
                alert("üèÜ M·ªü kh√≥a danh hi·ªáu: CHI·∫æN BINH K·ª≤ C·ª∞U");
            }
            // Check grade A
            if (!appData.badges.first_A && appData.subjects.some(s => s.gpa >= 3.6)) {
                appData.badges.first_A = true;
                alert("üèÜ M·ªü kh√≥a danh hi·ªáu: ƒêI·ªÇM A ƒê·∫¶U TI√äN");
            }
            renderBadges();
        }

        function renderBadges() {
            const list = document.getElementById('badgeList');
            list.innerHTML = `
                <div class="achievement ${appData.badges.first_A ? 'unlocked' : ''}" title="ƒê·∫°t ƒëi·ªÉm A m√¥n ƒë·∫ßu ti√™n">üÖ∞Ô∏è</div>
                <div class="achievement ${appData.badges.level_5 ? 'unlocked' : ''}" title="ƒê·∫°t Level 5">‚öîÔ∏è</div>
                <div class="achievement ${appData.tasks.filter(t=>t.done).length >= 10 ? 'unlocked' : ''}" title="Ho√†n th√†nh 10 nhi·ªám v·ª•">‚úÖ</div>
            `;
        }

        // --- MODULE: GRADES ---
        function addSubject() {
            const name = document.getElementById('subName').value || 'M√¥n h·ªçc';
            const cred = parseInt(document.getElementById('subCred').value);
            const qt = parseFloat(document.getElementById('subQT').value);
            const ck = parseFloat(document.getElementById('subCK').value);
            const ratio = parseFloat(document.getElementById('subRatio').value);

            if (isNaN(qt) || isNaN(ck)) return alert('Vui l√≤ng nh·∫≠p ƒëi·ªÉm!');

            const final = (qt * ratio) + (ck * (1 - ratio));
            let gpa = 0;
            if (final >= 8.5) gpa = 4.0;
            else if (final >= 7.0) gpa = 3.0;
            else if (final >= 5.5) gpa = 2.0;
            else if (final >= 4.0) gpa = 1.0;

            appData.subjects.push({ name, cred, final, gpa });
            addXP(100); // 100 XP cho m·ªói m√¥n
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            
            // Clear Inputs
            document.getElementById('subName').value = '';
            document.getElementById('subQT').value = '';
            document.getElementById('subCK').value = '';
            
            saveData();
            updateUI();
            checkBadges();
        }

        function deleteSub(index) {
            appData.subjects.splice(index, 1);
            saveData();
            updateUI();
        }

        // --- MODULE: TASKS ---
        function addTask() {
            const txt = document.getElementById('taskInput').value;
            if(!txt) return;
            appData.tasks.push({ text: txt, done: false });
            document.getElementById('taskInput').value = '';
            saveData();
            renderTasks();
        }

        function toggleTask(index) {
            appData.tasks[index].done = !appData.tasks[index].done;
            if(appData.tasks[index].done) addXP(20); // 20 XP cho m·ªói task
            saveData();
            renderTasks();
            checkBadges();
        }

        function deleteTask(index) {
            appData.tasks.splice(index, 1);
            saveData();
            renderTasks();
        }

        function renderTasks() {
            const container = document.getElementById('taskList');
            container.innerHTML = '';
            appData.tasks.forEach((t, i) => {
                container.innerHTML += `
                    <div class="todo-item ${t.done ? 'done' : ''}">
                        <div class="check-circle ${t.done ? 'checked' : ''}" onclick="toggleTask(${i})"></div>
                        <span style="flex:1">${t.text}</span>
                        <i class="fas fa-times" onclick="deleteTask(${i})" style="cursor:pointer; color:#555;"></i>
                    </div>
                `;
            });
            document.getElementById('dashTasks').textContent = appData.tasks.filter(t => t.done).length;
        }

        // --- MODULE: POMODORO ---
        function startTimer() {
            if(timerInterval) return;
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').textContent = `${m}:${s}`;

                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    alert("‚è∞ H·∫øt gi·ªù! H√£y ngh·ªâ ng∆°i.");
                    addXP(50);
                    timeLeft = 25 * 60;
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            timeLeft = 25 * 60;
            document.getElementById('timer').textContent = "25:00";
        }

        // --- MODULE: FINANCE ---
        function calcFinance() {
            const price = parseInt(document.getElementById('pricePerCredit').value);
            const totalCreds = appData.subjects.reduce((sum, s) => sum + s.cred, 0);
            document.getElementById('finCredits').textContent = totalCreds;
            document.getElementById('finTotal').textContent = (totalCreds * price).toLocaleString() + ' ƒë';
        }

        // --- CORE UPDATE ---
        function updateUI() {
            updateHeader();
            renderTasks();
            
            // Render Subjects
            const subList = document.getElementById('subjectList');
            subList.innerHTML = '';
            let totalCred = 0, totalPoint = 0;
            
            appData.subjects.forEach((s, i) => {
                totalCred += s.cred;
                totalPoint += s.gpa * s.cred;
                subList.innerHTML += `
                    <div style="background:rgba(255,255,255,0.05); padding:10px; margin-bottom:5px; border-radius:5px; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <strong>${s.name}</strong> <span style="font-size:0.8rem; color:#888">(${s.cred} t√≠n)</span>
                            <div style="font-size:0.8rem">ƒêi·ªÉm: ${s.final.toFixed(1)}</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span style="font-weight:bold; color:var(--primary)">GPA: ${s.gpa}</span>
                            <i class="fas fa-trash" onclick="deleteSub(${i})" style="color:#ff0055; cursor:pointer;"></i>
                        </div>
                    </div>
                `;
            });

            // Update Dash Stats
            const overallGPA = totalCred ? (totalPoint / totalCred).toFixed(2) : 0;
            document.getElementById('dashGPA').textContent = overallGPA;
            
            let rank = 'T√¢n Binh';
            if(overallGPA >= 3.6) rank = 'H·ªçc B√° V≈© Tr·ª•';
            else if(overallGPA >= 3.2) rank = 'Chi·∫øn Th·∫ßn';
            else if(overallGPA >= 2.5) rank = 'Chi·∫øn Binh';
            document.getElementById('rankTitle').textContent = rank;

            // Finance Update (Auto)
            calcFinance();

            // Chart
            updateChart(appData.subjects);
        }

        function updateChart(subs) {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            let dist = [0,0,0,0,0]; // A, B, C, D, F roughly
            subs.forEach(s => {
                if(s.gpa >= 3.6) dist[0]++;
                else if(s.gpa >= 3.0) dist[1]++;
                else if(s.gpa >= 2.0) dist[2]++;
                else if(s.gpa >= 1.0) dist[3]++;
                else dist[4]++;
            });

            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Gi·ªèi (A)', 'Kh√° (B)', 'TB (C)', 'Y·∫øu (D)', 'H·ªèng (F)'],
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng m√¥n',
                        data: dist,
                        backgroundColor: ['#00f2ea', '#00f2ea', '#7000ff', '#ff0055', '#333'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { color: '#888' } }, x: { ticks: { color: '#888' } } }
                }
            });
        }

        function saveData() {
            localStorage.setItem('studentOS', JSON.stringify(appData));
        }

        // Sample Data for Timetable (Visual only)
        document.getElementById('d2').innerHTML = '<div style="background:#7000ff; padding:5px; border-radius:4px; font-size:0.8rem; margin-bottom:5px;">7:00 - To√°n CC</div>';
        document.getElementById('d4').innerHTML = '<div style="background:#00f2ea; color:#000; padding:5px; border-radius:4px; font-size:0.8rem;">13:00 - Ti·∫øng Anh</div>';
    </script>
</body>
</html>
