<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Th·ªùi ti·∫øt & gi·ªù th·∫ø gi·ªõi theo qu·ªëc gia</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #c9d6ff, #e2e2e2);
    text-align: center;
    padding: 30px;
  }
  .weather-box {
    margin: 20px auto;
    padding: 20px;
    max-width: 600px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 0 12px rgba(0,0,0,0.15);
  }
  input, select, button {
    padding: 10px;
    margin: 10px;
    font-size: 16px;
  }
  #cityList div {
    cursor: pointer;
    padding: 8px;
    border-bottom: 1px solid #ddd;
  }
  #cityList div:hover {
    background-color: #e0e0e0;
  }
  .weather-detail {
    margin-top: 15px;
  }
  img.weather-icon {
    vertical-align: middle;
  }
</style>
</head>
<body>
  <h1>üåç Th·ªùi ti·∫øt & Gi·ªù th·∫ø gi·ªõi theo qu·ªëc gia</h1>

  <div class="weather-box">
    <h2>Ch·ªçn qu·ªëc gia:</h2>
    <input type="text" id="countryInput" placeholder="Nh·∫≠p t√™n qu·ªëc gia (v√≠ d·ª•: Vietnam)" oninput="suggestCountries()">
    <div id="countrySuggestion" style="max-width: 600px; margin: 0 auto; text-align:left;"></div>
  </div>

  <div class="weather-box" id="cityContainer" style="display:none;">
    <h2>Danh s√°ch th√†nh ph·ªë</h2>
    <div id="cityList" style="text-align:left; max-height:250px; overflow-y:auto;"></div>
  </div>

  <div class="weather-box" id="weatherInfo" style="display:none;">
    <h2>Th√¥ng tin th·ªùi ti·∫øt & gi·ªù th·ª±c</h2>
    <p id="cityName"></p>
    <p id="localTime"></p>
    <p id="temp"></p>
    <p id="humidity"></p>
    <p id="weatherDesc"></p>
    <img id="weatherIcon" class="weather-icon" src="" alt="" />
  </div>

<script>
  const apiKey = "YOUR_API_KEY"; // Thay b·∫±ng API key c·ªßa b·∫°n t·ª´ openweathermap.org

  // D·ªØ li·ªáu tƒ©nh m·∫´u qu·ªëc gia - th√†nh ph·ªë - timezone (b·∫°n c√≥ th·ªÉ m·ªü r·ªông, l·∫•y t·ª´ API ho·∫∑c file JSON)
  const countryCityData = {
    "vietnam": [
      {name: "Hanoi", lat: 21.0285, lon: 105.8542, timezone: 7},
      {name: "Ho Chi Minh City", lat: 10.8231, lon: 106.6297, timezone: 7},
      {name: "Da Nang", lat: 16.0544, lon: 108.2022, timezone: 7}
    ],
    "japan": [
      {name: "Tokyo", lat: 35.6895, lon: 139.6917, timezone: 9},
      {name: "Osaka", lat: 34.6937, lon: 135.5023, timezone: 9},
      {name: "Sapporo", lat: 43.0618, lon: 141.3545, timezone: 9}
    ],
    "usa": [
      {name: "New York", lat: 40.7128, lon: -74.0060, timezone: -4},
      {name: "Los Angeles", lat: 34.0522, lon: -118.2437, timezone: -7},
      {name: "Chicago", lat: 41.8781, lon: -87.6298, timezone: -5}
    ]
  };

  const countries = Object.keys(countryCityData);

  function suggestCountries() {
    const input = document.getElementById("countryInput").value.toLowerCase();
    const suggestionBox = document.getElementById("countrySuggestion");
    suggestionBox.innerHTML = "";
    if(!input) return;

    const matches = countries.filter(c => c.startsWith(input)).slice(0,5);
    matches.forEach(c => {
      const div = document.createElement("div");
      div.textContent = capitalize(c);
      div.style.padding = "5px";
      div.style.cursor = "pointer";
      div.style.borderBottom = "1px solid #ccc";
      div.onclick = () => {
        document.getElementById("countryInput").value = capitalize(c);
        suggestionBox.innerHTML = "";
        showCityList(c);
      }
      suggestionBox.appendChild(div);
    });
  }

  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  function showCityList(countryKey) {
    const cityContainer = document.getElementById("cityContainer");
    const cityList = document.getElementById("cityList");
    cityList.innerHTML = "";
    cityContainer.style.display = "block";

    const cities = countryCityData[countryKey];
    cities.forEach(city => {
      const div = document.createElement("div");
      div.textContent = `${city.name} (UTC${city.timezone >= 0 ? "+" : ""}${city.timezone})`;
      div.onclick = () => fetchWeather(city);
      cityList.appendChild(div);
    });
  }

  // H√†m l·∫•y th·ªùi ti·∫øt v√† gi·ªù theo v·ªã tr√≠ th√†nh ph·ªë
  function fetchWeather(city) {
    const {lat, lon, name} = city;
    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=vi`)
      .then(res => res.json())
      .then(data => {
        // T√≠nh gi·ªù ƒë·ªãa ph∆∞∆°ng = UTC + timezone t·ª´ OpenWeatherMap (gi√¢y)
        const localTimestamp = (data.dt + data.timezone) * 1000;
        const localDate = new Date(localTimestamp);
        document.getElementById("weatherInfo").style.display = "block";
        document.getElementById("cityName").textContent = `üèôÔ∏è Th√†nh ph·ªë: ${name}`;
        document.getElementById("localTime").textContent = `üïí Gi·ªù ƒë·ªãa ph∆∞∆°ng: ${localDate.toLocaleString()}`;
        document.getElementById("temp").textContent = `üå°Ô∏è Nhi·ªát ƒë·ªô: ${data.main.temp}¬∞C`;
        document.getElementById("humidity").textContent = `üíß ƒê·ªô ·∫©m: ${data.main.humidity}%`;
        document.getElementById("weatherDesc").textContent = `üå§Ô∏è M√¥ t·∫£: ${data.weather[0].description}`;
        const iconCode = data.weather[0].icon;
        document.getElementById("weatherIcon").src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
        document.getElementById("weatherIcon").alt = data.weather[0].description;
      })
      .catch(() => alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu th·ªùi ti·∫øt!"));
  }
</script>
</body>
</html>
